<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Lesson 6: Spatial Weights and Applications</title>
    <meta charset="utf-8" />
    <meta name="author" content="Dr. Kam Tin Seong Assoc. Professor of Information Systems" />
    <script src="libs/header-attrs-2.10/header-attrs.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
    <link rel="stylesheet" href="css/text.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Lesson 6: Spatial Weights and Applications
### Dr. Kam Tin Seong<br/>Assoc. Professor of Information Systems
### School of Computing and Information Systems,<br/>Singapore Management University
### 2020-5-1 (updated: 2021-09-19)

---




# Content

.vlarge[
- Introduction to Spatial Weights
- Contiguity-Based Spatial Weights
    - Rook's
    - Queen's
- Distance-Band Spatial Weights
- Applications of Spatial Weights
]

???
This lesson consists of three main sections.  First, I am going to explain the basic concept of spatial weights.  This is followed by a discussion on various methods used to compute spatial weights.  Lastly, the applications of spatial wiehgts will be discussed.

---
## What is geographically referenced attribute?

.large[





```
## Rows: 323
## Columns: 12
## $ SUBZONE_N        &lt;chr&gt; "MARINA SOUTH", "PEARL'S HILL", "BOAT QUAY", "HENDERS~
## $ SUBZONE_C        &lt;fct&gt; MSSZ01, OTSZ01, SRSZ03, BMSZ08, BMSZ03, BMSZ07, BMSZ0~
## $ PLN_AREA_N       &lt;fct&gt; MARINA SOUTH, OUTRAM, SINGAPORE RIVER, BUKIT MERAH, B~
## $ PLN_AREA_C       &lt;fct&gt; MS, OT, SR, BM, BM, BM, BM, SR, QT, QT, QT, BM, ME, R~
## $ REGION_N         &lt;fct&gt; CENTRAL REGION, CENTRAL REGION, CENTRAL REGION, CENTR~
## $ REGION_C         &lt;fct&gt; CR, CR, CR, CR, CR, CR, CR, CR, CR, CR, CR, CR, CR, C~
*## $ YOUNG            &lt;dbl&gt; NA, 1100, 0, 2620, 2840, 2910, 2850, 0, 1120, 30, NA,~
*## $ `ECONOMY ACTIVE` &lt;dbl&gt; NA, 3420, 50, 7500, 6260, 7560, 8340, 50, 2750, 210, ~
*## $ AGED             &lt;dbl&gt; NA, 2110, 20, 3260, 1630, 3310, 3590, 10, 560, 50, NA~
*## $ TOTAL            &lt;dbl&gt; NA, 6630, 70, 13380, 10730, 13780, 14780, 60, 4430, 2~
*## $ DEPENDENCY       &lt;dbl&gt; NA, 0.9385965, 0.4000000, 0.7840000, 0.7140575, 0.822~
## $ geometry         &lt;MULTIPOLYGON [m]&gt; MULTIPOLYGON (((31495.56 30..., MULTIPOL~
```
]

???
A kind of data that is very similar to an ordinary data.  The only difference is that each observation is associated with some form of geography such as numbers of aged population by planning subzone.

---
### Describing attribute distribution

The dependency ratio values by planning subzone are normally distributed.

.center[
&lt;img src="Lesson06-Spatial_Weights_files/figure-html/unnamed-chunk-2-1.png" width="576" /&gt;
]

???
In statistics, we are interested to study if the observed distribution resemble normal distribution.  To provide an answer to the question, we have to go beyond EDA and apply Confirmatory Data Analysis or also know as statistical test to confirm the observated pattern is indeed resemble normal distribution.

---
### Geographical distribution question

.large[
Are the planning subzones with high proportion of dependency ratio randomly distributed over space?]

.center[

&lt;img src="Lesson06-Spatial_Weights_files/figure-html/unnamed-chunk-3-1.png" width="1080" /&gt;
]

???
When come of geographically referenced attributes, beside the distribution of the value, we are also interested to find out if the observed geographical patterns are randomly distributed.  Similarly to statistical, geovisualisation is not enough because the visual impression will change when different data classification methods is used. 

---
### Geographical distribution question

.large[
Are the planning subzones with high proportion of dependency ratio randomly distributed over space?]
.center[

&lt;img src="Lesson06-Spatial_Weights_files/figure-html/unnamed-chunk-4-1.png" width="1080" /&gt;
]

???
As a result, a formal statistical test of spatial randomness is needed.

---
## What are Spatial Weights *(wij)*

.large[
- A way to define spatial neighbourhood.]

.center[
![:scale 65%](img/image6-6.jpg)]

???
Before we can perform statistics test of spatial randomness, we need to understand how spatial relationship among geographical areas can be defined mathematically.

---
### Defining Spatial Weights

.center[
![:scale 70%](img/image6-7.jpg)]

???
There are at least two popular methods can be used to define spatial weights of geographical areas.  They are contiguity and distance.  Both of them are encoded in binary.

According to contiguity principle, two geographical areas are consider as neighbour if they share a common boundary.  Hence, if two geographical areas are neighbour, they will be indicated as 1.  On the other hand, if the two geographical areas are not neighbour, they will be indicated as 0.

According to distance principle, two geographical areas are consider as neighbour if their centroid as within a spefic distance.  Hence, if two geographical areas are neighbour, they will be indicated as 1.  On the other hand, if the two geographical areas are not neighbour, they will be indicated as 0.

---
### Contiguity Neighbours

.large[
- Contiguity (common boundary)

- What is a “shared” boundary?]

.center[
![](img/image6-8.jpg)]

???
This figure shows three different ways to define contiguity neighbours.  They are Rooks, Bishop and Queens methods.  Rooks and Queens are the two commonly used methods.  
The main different between Queens and Rooks is that Rooks only consider geographical areas that shared common boundaries but Queens method includes geographical areas touching at the tips of the target geographical area.

---
### Beyond the basic contiguity neighbours

.large[
There are also second-order, third-order, forth-order, etc contiguity]

.center[
![:scale 60%](img/image6-18.jpg)]

???
The figure show contiguity neighbours beyond the first order. As you can see that the second-order contiguity neighbours are also defined according to Rooks and Queens case. 

---
### Weights matrix: Adjacency-based neighbours

.large[
**Quiz**: With reference to the figure below, list down the neighbour(s) of area 1202 using Rook case]

.center[
![:scale 80%](img/image6-9.jpg)]

???
This figure shows a geographical area with nine locations.  Let us focus on location 1202.  According to Queens case, it has seven neighbours.  They are 1101, 1201, 1301, 1102, 1302, 1000, and 0901.  If Rooks case is consider, 1101 and 1301 will not be considered as neighbours because they do not share common boundaries with 1202. 

---
### Weights Matrix: Distance-based neighbours

.large[
**Quiz:** With reference to the figure below, create a weights matrix for d = 650.
]

.center[
![:scale 80%](img/image6-10.jpg)]

???
In this figure, a cut-off distance of 650m is used.  In this case, locations B, C and D are considered as neighbours of location A because all of them are with the 650m distance from A.  On the other hand, location E is not a neighbour of location A because their distance is 757m apart.

---
### Weights matrix: Measured distances

.center[
![:scale 80%](img/image6-11.jpg)]

???
In this figure, spatial weights are calculated as the inversed function of the distance.  In other word, two locations that are closer will be given higher weight than two locations that are further away.  For example, the distance of AB is 353 and the diatnce of AE is 757 and the spatial weights are 0.00283 and 0.00132 respectively. 

---
### Row standardisation

.large[In practice, row-standardised weights instead of spatial weights will be used.
]

.center[
![:scale 70%](img/image6-12.jpg)]

???
Row-standardised weights increase the influence of links from observations with few neighbours, which binary weights vary the influence of observations.
 + Those with many neighbours are up-weighted compared to those with few.
 + In this case, raw 1 have four neighbours, hence each neighbour will have a value of 1/4.  On the other hand, row number 2, has only two neighbour, hence each neighbour will be given a value of 1/2.

---
## Applications of Spatial Weights

.large[

Formally, for observation i, the spatial lag of yi, referred to as [Wy]i (the variable Wy observed for location i) is:] 

.center[
![:scale 35%](img/image6-17.jpg)]

.large[where the weights wij consist of the elements of the i-th row of the matrix W, matched up with the corresponding elements of the vector y.
]

???
With a neighbor structure defined by the non-zero elements of the spatial weights matrix W, a **spatially lagged variable** is a weighted sum or a weighted average of the neighboring values for that variable. In most commonly used notation, the spatial lag of y is then expressed as Wy.

---
### Spatially Lagged Variables

.large[
Spatial lag with row-standardized weights]

.center[
![:scale 70%](img/image6-19.png)]

???
This figure shows the spatially lagged of GPDPC summed up the GDPPC of all its neighbours except the target location itself.

---
### Spatial window sum

.large[
The spatial window sum uses and includes the diagonal element.]

.center[
![:scale 70%](img/image6-20.png)]

???
Spatial window sum, on the other hand, summed up the GDPPC of all neighbours and include the target location itself.

---
## References

+ Chapter 2. [Codifying the neighbourhood structure](https://www.insee.fr/en/statistiques/fichier/3635545/imet131-f-chapitre-2.pdf) of [Handbook of Spatial Analysis: Theory and Application with R](https://www.insee.fr/en/information/3635545).
+ François Bavaud (2010) ["Models for Spatial Weights: A Systematic Look"](https://onlinelibrary.wiley.com/doi/abs/10.1111/j.1538-4632.1998.tb00394.x) *Geographical Analysis*, Vol. 30, No.2, pp 153-171.
+ Tony H. Grubesic and Andrea L. Rosso (2014) ["The Use of Spatially Lagged Explanatory Variables for Modeling Neighborhood Amenities and Mobility in Older Adults"](https://www-jstor-org.libproxy.smu.edu.sg/stable/26326897?sid=primo&amp;seq=1#metadata_info_tab_contents), *Cityscape*, Vol. 16, No. 2, pp. 205-214.





    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="js/macros.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
